/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("sap.ca.scfld.md.controller.ScfldMasterController");jQuery.sap.require("travel.request.create.util.Formatters");sap.ca.scfld.md.controller.ScfldMasterController.extend("travel.request.create.view.Master",{onInit:function(){this.oDataModel=this.oApplicationFacade.getODataModel();this.oBundle=this.oApplicationFacade.getResourceBundle();this.getList().setNoDataText(this.oBundle.getText("LOADING"));this.registerMasterListBind(this.getList());var c=sap.ui.core.Component.getOwnerIdFor(this.getView());var C=sap.ui.component(c);C.oEventBus.subscribe("travel.request.create","RefreshUpdateDelete",this._handleRefreshUpdateDelete,this);this.oRouter.attachRoutePatternMatched(function(e){if(e.getParameter("name")==="detail"){var b=this.getBindingContextPathFor(e.getParameter("arguments"));var i=this.findItemByContextPath(b);var l=this.getList();var I=l.indexOfItem(i);var n=l.getItems()[I+1];this._sNextDetailPath=n&&n.getBindingContext(this.sModelName).getPath()}},this)},onDataLoaded:function(){this.getList().setNoDataText(this.oBundle.getText("NO_ITEMS_AVAILABLE"));if(this.getList().getItems().length<1){if(!sap.ui.Device.system.phone){this.showEmptyView("DETAIL_TITLE","NO_ITEMS_AVAILABLE")}}},_handleRefreshUpdateDelete:function(c,e,d){"use strict";var i;for(i=this.oDataModel.aBindings.length-1;i>=0;i--){if(this.oDataModel.aBindings[i].sPath===d.param){this.oDataModel.aBindings.splice(i,1);break}}if(!jQuery.device.is.phone){var l=this.getList().getItems();if(l.length>1){for(i=0;i<l.length;i++){var p=l[i].getBindingContext().sPath;if(p!==d.param){var I=this.findItemByContextPath(p);this.setListItem(I);break}}}else{this.showEmptyView("DETAIL_TITLE","NO_ITEMS_AVAILABLE")}}setTimeout(jQuery.proxy(function(){this.oDataModel.refresh(true)},this),800)},processMasterRefreshAfterCreate:function(){if(this.createdContextPath!==null){var l=this.getList(),I=l.getItems(),b,i,a;for(i=0,a=I.length;i<a;i+=1){b=I[i].getBindingContext();if(b&&b.sPath===this.createdContextPath){this.contextPath=undefined;this.setListItem(I[i],jQuery.device.is.phone);this.createdContextPath=null;return}}}},_handleNew:function(){this.oRouter.navTo("new",{},!jQuery.device.is.phone)},getHeaderFooterOptions:function(){var t=this;return{sI18NMasterTitle:"MASTER_TITLE",oAddOptions:{sI18nBtnTxt:"TRC_NEW",icon:"sap-icon://add",onBtnPressed:jQuery.proxy(this._handleNew,t),enabled:true}}}});
